syntax = "proto3";
package payouts;

import "google/protobuf/empty.proto";
import "google/protobuf/wrappers.proto";

enum RevenueShareType {
    Timetable = 0;
    PerTransaction = 1;
}

enum PayoutStatus {
    Pending = 0;
    Success = 1;
    Fail = 2;
    Approved = 3;
}

enum PayoutType {
    RevenueShare = 0;
    Withdrawal = 1;
    ExcessiveProfit = 2;
}

enum PaymentMethod {
    BankTransfer = 0;
    CryptoWithdrawal = 1;
    Both = 2;
}

message BankTransferDetails {
    double ProfitAmountToBeWithdrawn = 1;
    string Currency = 2;
    double FeeAmountToBeWithdrawn = 3;
    string BeneficiaryFirstName = 4;
    string BeneficiaryLastName = 5;
    string Address = 6;
    string City = 7;
    string Country = 8;
    string PostalCode = 9;
    string AccountNumberOrIban = 10;
    string SwiftCode = 11;
    string BankName = 12;
    string RefundFeeCurrency = 13;
    double TotalProfitAmountToBeWithdrawn = 14;
}

message CryptoWithdrawalDetails {
    double ProfitAmountToBeWithdrawn = 1;
    string FiatCurrency = 2;
    double FeeAmountToBeWithdrawn = 3;
    string Cryptocurrency = 4;
    string Network = 5;
    string CryptoWalletAddress = 6;
    string RefundFeeCurrency = 7;
    double TotalProfitAmountToBeWithdrawn = 8;
    double CryptoAmount = 9;
}

message NotSelectedPaymentDetails {}

message PaymentDetails {
    oneof detail {
        NotSelectedPaymentDetails NotSelected = 1;
        BankTransferDetails BankTransfer = 2;
        CryptoWithdrawalDetails CryptoWithdrawal = 3;
    }
}

message PayoutRequest {
    string Id = 1;
    int64 CreatedAt = 2;
    int64 PaidAt = 3;
    string TxId = 4;
    string ClientId = 5;
    string TraderAccountId = 6;
    PaymentDetails PaymentDetails = 7;
    PayoutStatus Status = 8;
    int32 AccountType = 9;
    PayoutType PayoutType = 10;
    int32 PlatformId = 11;
    double WithdrawalAmount = 12;
    string WithdrawalCurrency = 13;
    int64 ETag = 14;
    double FeeAmount = 15;
    double TotalWithdrawalAmount = 16;
    double RevenueShare = 17;
    int64 UpdatedAt = 18;
    int64 ProcessedAt = 19;
    optional string OfficerId = 20;
}

message ProfitWidget {
    double withdrawn_profit = 1;
    double pending_profit = 2;
    double refund_fee_amount = 3;
    double current_profit = 4;
    double left_to_withdraw_in_profit_period = 5;
    double trader_account_revenue_share_percentage = 6;
    PayoutRestriction restriction = 7;
    string trading_package_id = 8;
}

enum PayoutRestriction {
    NONE = 0;
    PERIOD_PENDING = 1;
    PAYOUT_PENDING = 2;
    BEST_DAY_RULE_BREACHED = 3;
    TradingNotStarted = 4;
    AccountDisabled = 5;
    PayoutAlreadyRequested = 6;
}

message GetByClientIdRequest {
    string ClientId = 1;
    int64 Offset = 2;
    int64 Limit = 3;
    optional string TraderAccountId = 4;
    repeated PayoutType PayoutType = 5;
}

message GetByClientIdResponse {
    repeated PayoutRequest Payouts = 1;
    uint64 TotalCount = 2;
}

message CreatePayoutRequest {
    string ClientId = 1;
    string TraderAccountId = 2;
    string ProcessId = 3;
    PaymentDetails PaymentDetails = 4;
    double WithdrawalAmount = 5;
    string WithdrawalCurrency = 6;
}

message CreatePayoutResponse {
    oneof response {
        PayoutRequest Payout = 1;
        PayoutsGrpcServiceErrorWithMessage Error = 2;
    }
}

message GetProfitWidgetRequest {
    string ClientId = 1;
    string TraderAccountId = 2;
}

message GetProfitWidgetResponse {
    oneof Response {
        ProfitWidget ProfitWidget = 1;
        PayoutsGrpcServiceError Error = 2;
    }
}

message GetByFiltersRequest {
    optional string ClientId = 1;
    optional string TraderAccountId = 2;
    optional int64 FromDate = 3;
    optional int64 ToDate = 4;
    repeated PayoutStatus Status = 5;
    optional string TransactionId = 6;
    optional PaymentMethod PaymentMethod = 7;
    repeated PayoutType Types = 8;
    int64 Offset = 20;
    int64 Limit = 21;
}

message GetByFiltersResponse {
    repeated PayoutRequest Payouts = 1;
    uint64 TotalCount = 2;
}

message ApprovePayoutRequest {
    string PayoutId = 1;
    string ProcessId = 2;
    string Currency = 3;
    double Amount = 4;
    string OfficerId = 5;
}

message ApprovePayoutResponse {
     oneof response {
        PayoutRequest Payout = 1;
        PayoutsGrpcServiceError Error = 2;
    }
}

message DeclinePayoutRequest {
    string PayoutId = 1;
    string ProcessId = 2;
    string OfficerId = 5;
}

message DeclinePayoutResponse {
     oneof response {
        PayoutRequest Payout = 1;
        PayoutsGrpcServiceError Error = 2;
    }
}

message GetPayoutsStatisticRequest {}

message GetPayoutsStatisticResponse {
    double ProfitToBeWithdrawn = 1;
    double TotalCurrentUsersProfit = 2;
    double TotallyWithdrawn = 3;
    double PendingPayouts = 4;
    double FeeToBeRefunded = 5;
    double WithdrawnFeeRefund = 6;
    double PotentialFeeRefund = 7;
}

message GetPayoutsStatisticForClientRequest {
    string ClientId = 1;
}

message GetPayoutsStatisticForClientResponse {
    repeated TraderAccountStatistic TraderAccountStatistic = 1;
}

message TraderAccountStatistic {
    string TraderAccountId = 1;
    double ProfitToBeWithdrawn = 2;
    double TotalCurrentUsersProfit = 3;
    double TotallyWithdrawn = 4;
    double WithdrawnFeeRefund = 5;
}

message GetRevenueShareByFiltersRequest {
    optional string TraderAccountId = 1;
    optional int64 FromDate = 2;
    optional int64 ToDate = 3;
    optional string TransactionId = 4;
    optional string ClientId = 5;
    int64 Offset = 20;
    int64 Limit = 21;
}

message GetRevenueShareByFiltersResponse {
    repeated RevenueShareItem Payouts = 1;
    double TotalAmount = 2;
    uint64 TotalCount = 3;
}

message GetExcessiveProfitByFiltersRequest {
    optional string TraderAccountId = 1;
    optional int64 FromDate = 2;
    optional int64 ToDate = 3;
    optional string TransactionId = 4;
    optional string ClientId = 5;
    int64 Offset = 20;
    int64 Limit = 21;
}

message GetExcessiveProfitByFiltersResponse {
    repeated PayoutRequest Payouts = 1;
    double TotalAmount = 2;
    uint64 TotalCount = 3;
}

message RevenueShareItem {
    string Id = 1;
    int64 CreatedAt = 2;
    string TxId = 3;
    string ClientId = 4;
    string TraderAccountId = 5;
    string ProfitReleaseId = 6;
    double Amount = 7;
    string Currency = 8;
    double RevenueSharePercent = 9;
    RevenueShareType RevenueShareType = 10;
}

enum PayoutsGrpcServiceError {
    INTERNAL = 0;
    NOT_FOUND = 1;
    UNAUTHORIZED = 2;
    NOT_ENOUGH_BALANCE = 3;
    CANT_MAKE_DECISION = 4;
    BLOCKED = 5;
    USER_HAS_OPEN_POSITIONS = 6;
    LESS_THAN_MIN_VALUE = 7;
    EXCEEDS_MAX_VALUE = 8;
}

message PayoutsGrpcServiceErrorWithMessage {
    PayoutsGrpcServiceError Error = 1;
    string Message = 2;
}

message GetByIdRequest {
    string Id = 1;
}

message GetByIdResponse {
    oneof response {
        PayoutRequest Payout = 1;
        PayoutsGrpcServiceError Error = 2;
    }
}

message GetPayoutSettingsRequest {}

message CryptoCurrency {
    string crypto = 1;
    repeated string networks = 2;
}

message PayoutLimitsSettings {
    double min_amount = 1;
    double max_amount = 2;
    string min_currency = 3;
    string max_currency = 4;
}

message PayoutSettings {
    repeated string currencies = 1;
    repeated CryptoCurrency cryptos = 2;
    bool is_bank_transfer_enabled = 3;
    PayoutLimitsSettings bank_transfer_limits = 4;
    PayoutLimitsSettings crypto_limits = 5;
    // Optional in Rust â†’ wrappers.DoubleValue in proto3
    google.protobuf.DoubleValue excessive_profit_percent = 6;
    string trading_package_id = 7;
}

message GetPayoutSettingsResponse {
    repeated PayoutSettings items = 1;
}

message SetPayoutSettingsRequest {
    PayoutSettings item = 1;
}

message SetPayoutSettingsResponse {
    PayoutSettings item = 1;
}

message PayoutSchedulingSettings {
    int64 FirstPayoutInDays = 1;
    int64 FirstPayoutInMinutes = 2;
    int64 FurtherPayoutsInDays = 3;
    int64 FurtherPayoutsInMinutes = 4;
    string Phase = 5;
    string TradingPackageId = 6;
}

message GetPayoutSchedulingSettingsRequest {}

message GetPayoutSchedulingSettingsResponse {
    repeated PayoutSchedulingSettings items = 1;
}

message SetPayoutSchedulingSettingsRequest {
    PayoutSchedulingSettings item = 1;
}

message SetPayoutSchedulingSettingsResponse {
    PayoutSchedulingSettings item = 1;
}

message GetRevenueShareAmountByClientIdsRequest {
    optional int64 FromDate = 2;
    optional int64 ToDate = 3;
    repeated string ClientIds = 5;
}

message GetRevenueShareAmountByClientIdsResponse {
    double TotalAmount = 2;
}

message GetExcessiveProfitByClientIdsRequest {
    optional int64 FromDate = 2;
    optional int64 ToDate = 3;
    repeated string ClientIds = 5;
}

message GetExcessiveProfitByClientIdsResponse {
    double TotalAmount = 2;
}

message GetHighestWithdrawalRequest { }

message GetHighestWithdrawalResponse {
    double Withdrawal = 1;
    string ClientId = 2;
    string TraderAccountId = 3;
}

message GetHighestTotalWithdrawalRequest {}

message GetHighestTotalWithdrawalResponse {
    double TotalWithdrawal = 1;
    string ClientId = 2;
    string TraderAccountId = 3;
}

service PayoutsGrpcService {
    rpc GetById(GetByIdRequest) returns (GetByIdResponse);
    rpc GetByClientId(GetByClientIdRequest) returns (GetByClientIdResponse);
    rpc GetByFilters(GetByFiltersRequest) returns (GetByFiltersResponse);
    rpc GetRevenueShareByFilters(GetRevenueShareByFiltersRequest) returns (GetRevenueShareByFiltersResponse);
    rpc GetExcessiveProfitByFilters(GetExcessiveProfitByFiltersRequest) returns (GetExcessiveProfitByFiltersResponse);

    rpc CreatePayout(CreatePayoutRequest) returns (CreatePayoutResponse);
    rpc ApprovePayout(ApprovePayoutRequest) returns (ApprovePayoutResponse);
    rpc DeclinePayout(DeclinePayoutRequest) returns (DeclinePayoutResponse);

    rpc GetProfitWidget(GetProfitWidgetRequest) returns (GetProfitWidgetResponse);
    rpc GetPayoutsStatistic(GetPayoutsStatisticRequest) returns (GetPayoutsStatisticResponse);
    rpc GetPayoutsStatisticForClient(GetPayoutsStatisticForClientRequest) returns (GetPayoutsStatisticForClientResponse);

    rpc GetPayoutSettings(GetPayoutSettingsRequest) returns (GetPayoutSettingsResponse);
    rpc SetPayoutSettings(SetPayoutSettingsRequest) returns (SetPayoutSettingsResponse);

    rpc GetPayoutSchedulingSettings(GetPayoutSchedulingSettingsRequest) returns (GetPayoutSchedulingSettingsResponse);
    rpc SetPayoutSchedulingSettings(SetPayoutSchedulingSettingsRequest) returns (SetPayoutSchedulingSettingsResponse);

    //For internal clients
    rpc GetRevenueShareAmountByClientIds(GetRevenueShareAmountByClientIdsRequest) returns (GetRevenueShareAmountByClientIdsResponse);
    rpc GetExcessiveProfitByClientIds(GetExcessiveProfitByClientIdsRequest) returns (GetExcessiveProfitByClientIdsResponse);
    rpc GetHighestWithdrawal(GetHighestWithdrawalRequest) returns (GetHighestWithdrawalResponse);
    rpc GetHighestTotalWithdrawal(GetHighestTotalWithdrawalRequest) returns (GetHighestTotalWithdrawalResponse);

    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}
