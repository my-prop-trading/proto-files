syntax = "proto3";
package client_splits;

import "google/protobuf/empty.proto";

message Rule {
  float percent = 1;
  repeated string countries = 2;
  bool only_new_clients = 3;
}

enum FeatureKind {
  FEATURE_KIND_PAYMENT = 0;
}

enum FeatureAttribute {
  FEATURE_ATTRIBUTE_PROVIDER_ID = 0;
}

message Feature {
  FeatureKind kind = 1;
  map<int32, string> attributes = 2;
}

message Group {
  string id = 1;
  string name = 2;
  int32 weight = 3;
  repeated Feature features = 4;
}

message Experiment {
  string id = 1;
  string name = 2;
  bool enabled = 3;
  Rule rule = 4;
  repeated Group groups = 5;
  int64 created_at = 6;
  int64 updated_at = 7;
  string description = 8;
}

message Assignment {
  string id = 1;
  int64 created_at = 2;
  string client_id = 3;
  string experiment_id = 4;
  string group_id = 5;
}

message GetExperimentsRequest {
  int32 limit = 1;
  int32 offset = 2;
}

message GetExperimentsResponse {
  repeated Experiment experiments = 1;
}

message CreateOrUpdateExperimentsRequest {
  repeated Experiment experiments = 1;
}

message CreateOrUpdateExperimentsResponse {
  repeated Experiment experiments = 1;
}

message DeleteExperimentRequest {
  string experiment_id = 1;
}

message DeleteExperimentResponse {
  bool deleted = 1;
}

message GetClientGroupRequest {
  string client_id = 1;
}

message GetClientGroupResponse {
  Group group = 1;
}

message GetAssignmentsRequest {
  uint32 limit = 1;
  uint32 offset = 2;
  repeated string client_ids = 3;
  repeated string group_ids = 4;
  repeated string experiment_ids = 5;
}

message GetAssignmentsResponse {
  repeated Assignment assignments = 1;
}

message CreateOrUpdateAssignmentsRequest {
  repeated Assignment assignments = 1;
}

message CreateOrUpdateAssignmentsResponse {}

message DeleteAssignmentRequest {
  string assignment_id = 1;
}

message DeleteAssignmentResponse {
  bool deleted = 1;
}

service ClientSplitsGrpcService {
  rpc GetExperiments(GetExperimentsRequest) returns (GetExperimentsResponse);
  rpc CreateOrUpdateExperiments(CreateOrUpdateExperimentsRequest) returns (CreateOrUpdateExperimentsResponse);
  rpc DeleteExperiment(DeleteExperimentRequest) returns (DeleteExperimentResponse);
  rpc GetClientGroup(GetClientGroupRequest) returns (GetClientGroupResponse);
  rpc GetAssignments(GetAssignmentsRequest) returns (GetAssignmentsResponse);
  rpc CreateOrUpdateAssignments(CreateOrUpdateAssignmentsRequest) returns (CreateOrUpdateAssignmentsResponse);
  rpc DeleteAssignment(DeleteAssignmentRequest) returns (DeleteAssignmentResponse);

  rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}
